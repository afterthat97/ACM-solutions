---
title: AOJ 2170 并查集
date: 2018-11-27 19:07:43
categories:
  - AOJ
tags:
  - 并查集
---

题目链接：http://judge.u-aizu.ac.jp/onlinejudge/description.jsp?id=2170

有一棵树，初始时只有根节点被染了色。现在有一系列操作，可以分为两类：

1. 给结点 $p$ 染色
2. 求结点 $p$ 最近的且被染色的祖先

<!-- more -->

## 思路

不难想到并查集中的 `getfa` 函数，不过按照题目要求顺序处理肯定会 TLE。

不过我们可以发现，随着时间的推移，越来越多的结点被染色，某个结点的最近的且被染色的祖先只会越来越近。因此我们可以逆向思考，记录下所有的操作，从最终状态往前处理。

本题的关键就是 `getfa` 函数，注意**路径压缩只能在逆向时使用**。

{% include_code acm-solutions/AOJ/2170.cpp %}
