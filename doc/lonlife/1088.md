---
title: 玲珑杯 1088 - 二叉堆
date: 2017-02-16 09:45:08
tags:
  - 二叉堆
categories:
  - 玲珑杯
---

“玲珑杯” ACM 比赛 Round #9 中的 C 题，一道思维逻辑题，利用优先队列可以解决。

原题链接：[http://www.ifrog.cc/acm/problem/1088](http://www.ifrog.cc/acm/problem/1088)

清单上一共有$n$个商品，每个商品都有它的价格`cost`和“快乐度收益”`val`，你拥有$k$元钱，并且必须从清单中选出连续的一些商品进行购买（即选定购买区间）。同时，你有$m$个“免费名额”，可以让区间中任意$m$个商品免费。

<!-- more -->

#### 样例解释

SAMPLE IMPUT:

```cpp
1
6 1 4
5 3 2 4 1 6
2 4 3 1 6 5
```

SAMPLE OUTPUT:

```cpp
11
```

你有 4 元钱和 1 个免费名额，因此可以选择最后两个商品，将免费名额用于价格为 6 元的商品，实际花费 1 元钱，获得快乐度收益为 11。

#### 解题思路

很显然，如果选定了区间，那么将免费名额用于区间中价格最高的$m$个商品，剩余商品花钱买，这样花费的总金额一定是最小的。
那么，可以使用$[l, r - 1]$来表示当前区间，假设对于该区间，使用上述策略可以买到所有商品。于是下一步考虑可否将第$r$号商品纳入购买区间。
我们定义两个堆：一个小根堆`q`来维护区间中价格最高的$m$个商品，一个大根堆`rest`来维护区间中剩下的商品。

于是我们得到的算法如下：

*   如果当前仍有免费名额，则直接将$r$号商品纳入购买区间，且加入`q`堆中；
*   如果当前没有免费名额，则需要尝试花钱买，具体又细分为三种情况：
  *   如果$r$号商品比当前`q`堆堆顶商品价格高（即$r$是$[l, r]$中最贵的$m$个商品之一），则可以尝试买下当前`q`堆堆顶商品（即从`q`堆`pop`该商品，加入`rest`堆中），将该免费名额用于$r$号商品（即将$r$号商品`push`入`q`堆）。
  *   如果$r$号商品比当前`q`堆堆顶商品价格低（即$[l, r]$中最贵的$m$个商品依然是$[l, r - 1]$中最贵的$m$个），则可以尝试买下$r$号商品（即将其`push`入`rest`堆，`q`堆不变）。
  *   如果上述两个尝试均不可行（即$r$号商品或`q`堆堆顶商品都买不起），则只能丢弃区间最左边的商品，考虑区间$[l + 1, r]$，重复该算法。

**注：丢弃区间最左商品时，分为两种情况：**

*   如果该商品在`q`堆中，则需要从`rest`中选出最贵的商品来替补它；
*   如果该商品不在`q`堆中，直接丢弃即可。

{% include_code acm-solutions/lonlife/round9/C.cpp %}
